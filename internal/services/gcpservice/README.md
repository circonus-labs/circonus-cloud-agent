# GCP

## Setup

### Google

1. Find project to monitor in GCP UI
1. Add service account to project
   * set service account name, e.g. 'circonus-cloud-agent'
   * add description
   * click create
   * add roles: project>viewer, monitoring>monitoring viewer, compute engine>compute viewer
   * create key, type json (note where the key is downloaded)
1. The following APIs must be enabled for the project
   * [Cloud Resource Manager API](https://console.cloud.google.com/apis/library/cloudresourcemanager.googleapis.com) - role _project>viewer_ is used to obtain the project meta data: ensure it is an active project, project name is used to create check bundle, project labels are added as a base set of stream tags along with project id
   * [Stackdriver Monitoring API](https://console.cloud.google.com/apis/library/monitoring.googleapis.com) - role _monitoring>monitoring viewer_ is used to retrieve available metrics and metric data
   * [Compute Engine API](https://console.cloud.google.com/apis/library/compute.googleapis.com) - role _compute engine>compute viewer_ is used to obtain a list of instances, obtain state/status of an instance, name, labels (for stream tags), etc.

### Agent

1. Decide on a unique id for the configuration instance - unique within the configuration directory (e.g. `test`)
1. Place the json file downloaded in GCP setup somewhere and ensure that the user running `circonus-cloud-agentd` will be able to read the file (e.g. `nobody` on linux when run as a systemd service).
1. Create a configuration in `etc/gcp.d` (e.g. id.(json|toml|yaml) - `test.yaml`) - an example config can be generated by `sbin/circonus-cloud-agentd --enable-gcp --gcp-example-conf=format` where format is one of `json|toml|yaml`. Ensure that the `gcp.credentials_file` is set to the full filespec of where the service account json file was placed.

## Configuration

```yaml
---
id: ""
gcp:
  credentials_file: ""
  collect_interval: 5
  services:
  - name: compute
    disabled: false
    filter:
      labels: {}
      expression: ""
    tags: []
circonus:
  cid: ""
  broker_cid: ""
  app: ""
  key: ""
  url: ""
  ca_file: ""
  debug: false
  trace_metrics: false
tags: []
```

### Minimum configuration

```yaml
---
id: ""
gcp:
  credentials_file: ""
circonus:
  key: ""
```
